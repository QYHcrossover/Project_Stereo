这部分内容之前看了几份材料后还是感觉有点绕，后来看了 Epipolar Geometry and Stereo Vision这份PDF后才逐渐搞清楚了一些概念；所以写篇博客来梳理下双目视觉的一些概念，包括**极线约束**、**旋转矩阵和平移向量**、**本征矩阵**、**基础矩阵**等

## 旋转矩阵和平移向量

双目视觉中有两个摄像机，双目相机标定时不仅需要完成两个单目摄像机的所有标定任务（**内参矩阵**、**畸变系数**、**外参矩阵**），还需要计算与左右两个相机的坐标系变换相关的参数，这个变换同样也是一种刚体变换；所以标定的同样是左右相机坐标系之间变换的**旋转矩阵**和**平移向量**。

我们先来规定一下符号，记：

- 左右相机的坐标系的旋转矩阵和平移向量分别为$R_l$,$t_l$,$R_r$,$t_r$
- 假设空间中一点P，其真实世界的坐标是$P_w$，其左右相机的坐标系下坐标分别为$P_l$、$P_r$
- 左相机坐标到右相机坐标的旋转矩阵是$R$,平移向量是$t$,注意这里方向一定要搞清楚，别搞反了；而且双目视觉中一般以左相机坐标为基准，所以也有设从右到左的分别是R和t的，一定得搞清楚

那么，首先由左右相机两坐标和真实坐标之间的关系：
$$
P_l = R_lP_w+T_l\\P_r=R_rP_w+T_r
$$
另外由$R$和$T$的定义可得
$$
P_r = RP_l+T
$$
**三个方程**却有$P_l$,$P_r$,$R$, $T$四个未知数，貌似解不出来；这里面还有一个隐藏条件，**对任意的$P_w$都成立**；所以将$P_l$和$P_r$待入第三个式子得
$$
R_rP_w + T_r = RR_lP_w+RT_l +T
$$
**将$P_w$看成未知数，各系数对应相等**，最终得到$R$和$T$表达式
$$
R = R_rR_l^{-1} \\T = T_r-RT_l
$$
这里$R_l^{-1}$也可以写成$R_l^T$,因为它是旋转矩阵

## 极线约束 Epipolar constraint

![image-20200720201339925](https://cdn.jsdelivr.net/gh/QYHcrossover/blog-imgbed/blogimg/20200720201341.png)

所谓极线约束就是，在左相机像平面上$x$点所对应的真实世界的$X$点，在右相机的像平面中投影点始终是在一条直线上，如图中的蓝线；反之，$x'$的极线就是图中的红线；这就是所谓的极线约束，看图应该很好理解。为什么不是一一对应的关系呢，因为是内参矩阵是一个降维的矩阵，将3维降到2维，这个过程是不可逆的！

此外还有一些名词解释一下：

- **基线Baseline** 指两个相机中心连成的直线$O_1O_2$
- **极平面Epipolar Plane** 指平面$OO'X$
- **极点 Epipoles** 指图上的点$e$、$e'$
- **极线 Epipolar Lines** 点$x$对应的极线是$e'x'$,点$x'$对应的极线是$xe$

## 本征矩阵 Essential Matrix

![image-20200721084224052](https://cdn.jsdelivr.net/gh/QYHcrossover/blog-imgbed/blogimg/20200721084225.png)

同样是这个模型，这次我们更加具体地**求解极线和极平面**，顺带在求解过程中，引入**本征矩阵E**这个概念

首先同样先定义符号，为了和图片对应；

- 用 **$x$** 和  **$x'$** 分别表示两像素平面的坐标，如上图所示；两内参矩阵分别表示为 $K$ 和 $K'$
- 图中点$X$在左右相机坐标系下的坐标分别记作 $\hat{x}$ 和 $\hat{x'}$，这三者之间都是通过旋转矩阵和平移向量来相互转换
- 用 $R$ 和 $t$ 表示从右相机坐标系到左相机坐标系的转换如上图，注意是**从右往左**！所有的都统一到左相机的坐标体系

那么根据各参数的含义，有三个关系
$$
\hat{x} = K^{-1}x \\
\hat{x’} = K'^{-1}x' \\
\hat{x} = R\hat{x’}+t
$$

接下来就是怎么求极平面了$XOO'$，这个其实只要简单运用一下线代的知识就行了；首先求平面法向量，如图不难发现法向量等于$OO'$和$OX$相叉乘；$O'O$就是平移向量$t$，而$OX$就是 $\hat{x}$ 啦；然后求平面上一条直线$OX$与法向量点乘为0就能得到平面方程了；
$$
法向量: t\times\hat{x}= t\times(R\hat{x’}+t)=t\times R\hat{x'} \\
平面方程: \hat{x}\cdot(t\times R\hat{x'})=0
$$

如果将$t\times R$ 记作 $E$,那么平面方程也可以写成
$$
\hat{x}^TE\hat{x}'=0 \\
E = t \times R
$$
这里的$E$就是所谓的本征矩阵，通过$E$我们就可以求$x$和$x'$的极线了，ps：这个极线也是在相机坐标体系下

- $x'$点所对应的极线是$Ex'$
- $x$点所对应的极线是$E^Tx$

本征矩阵$E$还有一些性质，E是奇异矩阵，有5个自由度；这个我还没有仔细研究，暂且不表

## 基础矩阵 Fundamental Matrix

同样是本征矩阵的模型，我们很多时候并不关心相机坐标系，而是关心那个像平面的像素坐标系；而这两者之前通过内参矩阵就可以转换。

首先我们有

$$
\hat{x} = K^{-1}x \\
\hat{x’} = K'^{-1}x' \\
\hat{x}^TE\hat{x}'=0
$$
那么我们就把 $\hat{x}$ 和 $\hat{x’}$ 代入后面的平面方程中，就有
$$
x^Tk^{-T}EK^{-1}x'=0
$$
其中令$k^{-T}EK^{-1}=F$, $F$就是基础矩阵

同样地，我们也可以通过基础矩阵求解在像素体系下的极线表达方式

- $l = F x’$表示 $x'$对应的极线表示方法
- $l’ = F^Tx$ 表示$x$对应的极线表示方法

和本征矩阵相似，基础矩阵也有一些相关的性质

## References

- 计算机视觉笔记6——双目摄像机标定参数说明https://blog.csdn.net/xuelabizp/article/details/50417914
- Lecture 23 - Epipolar Geometry and Stereo - Vision_Spring2011